<!-- https://v3-docs.vuejs-korea.org/  -->
<html lang="ko" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>정말 귀찮아!</title>
    <style media="screen">
    .block{
      text-align: center;
      font-size: 30px;
      color: white;
    }
    #game{
      height: 500px;
      width: 500px;
      background-color: black;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      grid-template-rows: 1fr 1fr 1fr 1fr;
      grid-gap: 10px;
      padding: 10px;
    }
    #no{
      background-color: pink;
    }
    #yes{
      background-color: blue;
    }
    </style>
  </head>
  <body>
    <script src="https://unpkg.com/vue@3"></script>
    <div id="game">
      <div v-for="index in count" class = "block" id="no"></div>
    </div>
     <script>
     const { createApp } = Vue;
      createApp({
        data() {
          return {
            count : 16,
          }
        }
      }).mount('#game')
      var Counts = [[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]] // 숫자 배열
      var Blocks = document.getElementsByClassName("block")
      function Update(){
        console.log(Counts[0])
        console.log(Counts[1])
        console.log(Counts[2])
        console.log(Counts[3])
        for(var i = 0; i < 4; i++){
          for(var j = 0; j < 4; j++){
            var a = i * 4;
            var b = a + j;
            if(Counts[i][j] != 0){
              Blocks[b].innerHTML = Counts[i][j]; // 배열의 값을 블록에 넣음
              Blocks[b].id = "yes";
            }else{
              Blocks[b].innerHTML = ""; // 배열의 값을 블록에 넣음
              Blocks[b].id = "no";
            }
          }
        }
      }
      function MakeRandomN(){
        while(true){
          var X = parseInt(Math.random() * 4);
          var Y = parseInt(Math.random() * 4);
          if(Counts[X][Y] == 0){
            Counts[X][Y] = 2;
            break;
          }
        }
      }
      function MoveLeft(){
        var is_moved = false; // 움직였는지 여부
        for(var i = 0; i < 4; i++){
          for(var j = 0; j < 4; j++){
            if(Counts[i][j] != 0){
              var val = Counts[i][j]
              for(var k = j -1; k >=0; k--){
                if(Counts[i][k] != 0){ // 옆칸에 값이 있다면
                  if(Counts[i][k] == Counts[i][k+1]){ // 옆칸의 값이 대상 값과 같다면
                    Counts[i][k] *= 2;
                    Counts[i][k+1] = 0;
                    is_moved = true;
                    break;
                  }else{ // 옆칸의 값이 대상 값과 다르다면
                    break; // 반복문 break;
                  }
                }else{ // 옆 칸에 값이 없다면
                  Counts[i][k] = Counts[i][k+1];
                  Counts[i][k+1] = 0;
                  is_moved = true;
                }
              }
            }
          }
        }
        if(is_moved) MakeRandomN();
      }

      function MoveRight(){
        var is_moved = false; // 움직였는지 여부
        for(var i = 0; i < 4; i++){
          for(var j = 3; j >= 0; j--){
            if(Counts[i][j] != 0){
              var val = Counts[i][j]
              for(var k = j +1; k < 4; k++){
                if(Counts[i][k] != 0){ // 옆칸에 값이 있다면
                  if(Counts[i][k] == Counts[i][k-1]){ // 옆칸의 값이 대상 값과 같다면
                    Counts[i][k] *= 2;
                    Counts[i][k-1] = 0;
                    is_moved = true;
                    break;
                  }else{ // 옆칸의 값이 대상 값과 다르다면
                    break; // 반복문 break;
                  }
                }else{ // 옆 칸에 값이 없다면
                  Counts[i][k] = Counts[i][k-1];
                  Counts[i][k-1] = 0;
                  is_moved = true;
                }
              }
            }
          }
        }
        if(is_moved) MakeRandomN();
      }
      function MoveUp(){
        var is_moved = false; // 움직였는지 여부
        for(var j = 0; j < 4; j++){
          for(var i = 0; i < 4; i++){
            if(Counts[i][j] != 0){
              var val = Counts[i][j]
              for(var k = i -1; k >=0; k--){
                if(Counts[k][j] != 0){ // 옆칸에 값이 있다면
                  if(Counts[k][j] == Counts[k+1][j]){ // 옆칸의 값이 대상 값과 같다면
                    Counts[k][j] *= 2;
                    Counts[k+1][j] = 0;
                    is_moved = true;
                    break;
                  }else{ // 옆칸의 값이 대상 값과 다르다면
                    break; // 반복문 break;
                  }
                }else{ // 옆 칸에 값이 없다면
                  Counts[k][j] = Counts[k+1][j];
                  Counts[k+1][j] = 0;
                  is_moved = true;
                }
              }
            }
          }
        }
        if(is_moved) MakeRandomN();
      }
      function MoveDown(){
        var is_moved = false; // 움직였는지 여부
        for(var j = 0; j < 4; j++){
          for(var i = 3; i >= 0; i--){
            if(Counts[i][j] != 0){
              var val = Counts[i][j]
              for(var k = i +1; k < 4; k++){
                if(Counts[k][j] != 0){ // 옆칸에 값이 있다면
                  if(Counts[k][j] == Counts[k-1][j]){ // 옆칸의 값이 대상 값과 같다면
                    Counts[k][j] *= 2;
                    Counts[k-1][j] = 0;
                    is_moved = true;
                    break;
                  }else{ // 옆칸의 값이 대상 값과 다르다면
                    break; // 반복문 break;
                  }
                }else{ // 옆 칸에 값이 없다면
                  Counts[k][j] = Counts[k-1][j];
                  Counts[k-1][j] = 0;
                  is_moved = true;
                }
              }
            }
          }
        }
        if(is_moved) MakeRandomN();
      }
      document.addEventListener("keydown", DK, false);
      function DK(event){
        switch(event.keyCode) {
      		case 37:
          MoveLeft();
          Update();
    			console.log("left Pressed")
    			break;
      		case 38:
          MoveUp();
          Update();
    			console.log("up Pressed")
    			break;
      		case 39:
          MoveRight();
          Update();
    			console.log("right Pressed")
    			break;
      		case 40:
          MoveDown();
          Update();
      			console.log("down Pressed")
      			break;
      	}
      }
      window.onload = function(){
        MakeRandomN();
        Update();
      }
     </script>
  </body>
</html>
