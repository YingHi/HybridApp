<!-- https://v3-docs.vuejs-korea.org/  -->
<html lang="ko" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>정말 귀찮아!</title>
    <style media="screen">
    .block{
      text-align: center;
      font-size: 30px;
      color: white;
      display: absolute;
    }
    #ReadyBoard{
      display: none;
    }
    #StartBoard{
      display: block;
    }
    #EndScene{
      display: none;
    }
    #ClearScene{
      display: none;
    }
    #game{
      height: 500px;
      width: 500px;
      background-color: black;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      grid-template-rows: 1fr 1fr 1fr 1fr;
      grid-gap: 10px;
      padding: 10px;
    }
    #ab{
      text-align: center;
      font-size: 30px;
      color: black;
      position: absolute;
      top: 250px;
      left: 150px;

      height: 120px;
      width: 120px;
      background-color: gray;
    }
    #no{
      background-color: #DDDDDD;
    }
    #count2{
      background-color: #666666;
    }
    #count4{
      background-color: #666688;
    }
    #count8{
      background-color: #886688;
    }
    #count16{
      background-color: #888888;
    }
    #count32{
      background-color: #8888AA;
    }
    #count64{
      background-color: #AA88AA;
    }
    #count128{
      background-color: #AAAAAA;
    }
    #count256{
      background-color: #AAAABB;
    }
    #count512{
      background-color: #BBAABB;
    }
    #count1024{
      background-color: #BBAABB;
    }
    #count2048{
      background-color: #BBBBBB;
    }
    </style>
  </head>
  <body>
    <script src="https://unpkg.com/vue@3"></script>
    <div id="StartScene" style="width:500px">
      <img src="Start.png" alt="">
      <img id="StartBtn" src="Button.jpg" alt="">
    </div>
    <div id="ClearScene" style="width:500px">
      <img src="good~.png" alt="">
      <img src="good~.png" alt="">
      <img src="good~.png" alt="">
      <img src="good~.png" alt="">
      <img src="good~.png" alt="">
      <img src="good~.png" alt="">
      <img src="good~.png" alt="">
      <img src="good~.png" alt="">
      <h3 id="ClearText"></h1>
      <img src="good~.png" alt="">
      <img src="good~.png" alt="">
      <img src="good~.png" alt="">
      <img src="good~.png" alt="">
      <img src="good~.png" alt="">
      <img src="good~.png" alt="">
      <img src="good~.png" alt="">
      <img src="good~.png" alt="">
    </div>
    <div id="EndScene">
      <img src="End.jpg" alt="">
    </div>
    <div id="ReadyBoard">
      <div id="game">
        <div v-for="index in count" class = "block" id="no"></div>
        //<div id = "ab">안녕</div>
      </div>
      <h1 id = "text">MoveCount : 0</h1>
    </div>
     <script>
     const { createApp } = Vue;
      createApp({
        data() {
          return {
            count : 16,
          }
        }
      }).mount('#game')
      class GameManager{
        constructor() { //생성자
          this.Blocks = document.getElementsByClassName("block")
          this.text = document.getElementById("text");
          this.Board = document.getElementById("ReadyBoard");
          this.StartBtn = document.getElementById("StartBtn");
          this.StartScene = document.getElementById("StartScene");
          this.EndScene = document.getElementById("EndScene");
          this.ClearText = document.getElementById("ClearText")
          this.Score;
          this.gameState;
          this.Move = [[[0,0],[0,1],[0,2],[0,3]],[[1,0],[1,1],[1,2],[1,3]],[[2,0],[2,1],[2,2],[2,3]],[[3,0],[3,1],[3,2],[3,3]]]
          this.Check = [[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];
          this.Counts = [[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];
        }
      }
      var Gm
      function animate(){

      }
      function Mul2(a,b){
        Gm.Counts[a][b] *= 2;
        Gm.Check[a][b] = 1;
        if(Gm.Counts[a][b] == 2048){
          Clear();
        }
      }
      function Change(a,b,c,d){
        if(d == "L" || d == "R"){
          Gm.Counts[a][b] = Gm.Counts[a][c];
          Gm.Counts[a][c] = 0;
        }else if(d == "U" || d == "D"){
          Gm.Counts[a][b] = Gm.Counts[c][b];
          Gm.Counts[c][b] = 0;
        }
      }
      function Update(){
        for(var i = 0; i < 4; i++){
          for(var j = 0; j < 4; j++){
            var a = i * 4;
            var b = a + j;
            if(Gm.Counts[i][j] != 0){
              Gm.Blocks[b].innerHTML = Gm.Counts[i][j]; // 배열의 값을 블록에 넣음
              Gm.Blocks[b].id = "count" + Gm.Counts[i][j];
            }else{
              Gm.Blocks[b].innerHTML = ""; // 배열의 값을 블록에 넣음
              Gm.Blocks[b].id = "no";
            }
          }
        }
        var is_End = 0; // 게임 종료 판별
        for(var i = 0; i < 4; i++){
          for(var j = 0; j < 4; j++){
            var Can_Move = 4;
            if(i == 0) Can_Move-=1; // 맨 왼쪽이면 이동불가
            else if(Gm.Counts[i-1][j] != 0 && Gm.Counts[i-1][j] != Gm.Counts[i][j]) Can_Move-=1 // 왼쪽이동가능여부 확인
            if(i == 3) Can_Move-=1; // 맨 오른쪽이면 이동불가
            else if(Gm.Counts[i+1][j] != 0 && Gm.Counts[i+1][j] != Gm.Counts[i][j]) Can_Move-=1 // 오른쪽이동가능여부 확인
            if(j == 0) Can_Move-=1; // 맨 위쪽이면 이동불가
            else if(Gm.Counts[i][j-1] != 0 && Gm.Counts[i][j-1] != Gm.Counts[i][j]) Can_Move-=1 // 위쪽이동가능여부 확인
            if(j == 3) Can_Move-=1; // 맨 아래쪽이면 이동불가
            else if(Gm.Counts[i][j+1] != 0 && Gm.Counts[i][j+1] != Gm.Counts[i][j]) Can_Move-=1 // 아래쪽이동가능여부 확인
            if(Can_Move == 0) is_End += 1;
            }
          }
        if(is_End == 16){
          End();
        }
        Gm.Check = [[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]] // 초기화
        this.Move = [[[0,0],[0,1],[0,2],[0,3]],[[1,0],[1,1],[1,2],[1,3]],[[2,0],[2,1],[2,2],[2,3]],[[3,0],[3,1],[3,2],[3,3]]]
        Gm.innerHTML = "MoveCount : " + Gm.Score; // 점수 업데이트
      }
      function StartMakeRandomN(){
        var A = parseInt(Math.random() * 100);
        if(A > 33){
          while(true){
            var X = parseInt(Math.random() * 4);
            var Y = parseInt(Math.random() * 4);
            if(Gm.Counts[X][Y] == 0){
              if(A > 66){
                Gm.Counts[X][Y] = 4;
                break;
              }else{
                Gm.Counts[X][Y] = 2;
                break;
              }
            }
          }
        }else{
          for(var i = 0; i < 2; i++){
            while(true){
              var X = parseInt(Math.random() * 4);
              var Y = parseInt(Math.random() * 4);
              if(Gm.Counts[X][Y] == 0){
                if(i == 0){
                  Gm.Counts[X][Y] = 2;
                  break;
                }else{
                  Gm.Counts[X][Y] = 4;
                  break;
                }
              }
            }
          }
        }
      }
      function MakeRandomN(){
        if(Gm.gameState == "Play"){
          while(true){
            var X = parseInt(Math.random() * 4);
            var Y = parseInt(Math.random() * 4);
            if(Gm.Counts[X][Y] == 0){
              var Z = parseInt(Math.random() * 10);
              if(Z > 7){
                Gm.Counts[X][Y] = 4;
                break;
              }else{
                Gm.Counts[X][Y] = 2;
                break;
              }
            }
          }
          Gm.Score+=1;
        }
      }
      function MoveLeft(){
        var is_moved = false; // 움직였는지 여부ㅓ
        for(var i = 0; i < 4; i++){
          for(var j = 0; j < 4; j++){
            if(Gm.Counts[i][j] != 0){ // 지금 선택된 칸이 0이 아니라면(값이 있다면)
              for(var k = j -1; k >=0; k--){ // 왼쪽으로 이동, 만약에 같은 값이 있다면 합치기
                if(Gm.Counts[i][k] != 0){ // 옆칸에 값이 있다면
                  if(Gm.Counts[i][k] == Gm.Counts[i][k+1] && Gm.Check[i][k] == 0){ // 옆칸의 값이 대상 값과 같다면
                    Mul2(i,k);
                    Gm.Move[i][j][0] = i;
                    Gm.Move[i][j][1] = k;
                    is_moved = true;
                    break;
                  }else{ // 옆칸의 값이 대상 값과 다르다면
                    break; // 반복문 break;
                  }
                }else{ // 옆 칸에 값이 없다면
                  if(k < 4){
                    Change(i,k,k+1,"L");
                    is_moved = true;
                  }
                }
              }
            }
          }
        }
        if(is_moved) MakeRandomN();
      }
      function MoveRight(){
        var is_moved = false; // 움직였는지 여부
        for(var i = 0; i < 4; i++){
          for(var j = 3; j >= 0; j--){
            if(Gm.Counts[i][j] != 0){
              for(var k = j +1; k < 4; k++){
                if(Gm.Counts[i][k] != 0){ // 옆칸에 값이 있다면
                  if(Gm.Counts[i][k] == Gm.Counts[i][k-1] && Gm.Check[i][k] == 0){ // 옆칸의 값이 대상 값과 같다면
                    Mul2(i,k);
                    is_moved = true;
                    break;
                  }else{ // 옆칸의 값이 대상 값과 다르다면
                    break; // 반복문 break;
                  }
                }else{ // 옆 칸에 값이 없다면
                  if(k >= 0){
                    Change(i,k,k-1,"R");
                    is_moved = true;
                  }
                }
              }
            }
          }
        }
        if(is_moved) MakeRandomN();
      }
      function MoveUp(){
        var is_moved = false; // 움직였는지 여부
        for(var j = 0; j < 4; j++){
          for(var i = 0; i < 4; i++){
            if(Gm.Counts[i][j] != 0){
              for(var k = i -1; k >=0; k--){
                if(Gm.Counts[k][j] != 0){ // 옆칸에 값이 있다면
                  if(Gm.Counts[k][j] == Gm.Counts[k+1][j] && Gm.Check[k][j] == 0){ // 옆칸의 값이 대상 값과 같다면
                    Mul2(k,j);
                    is_moved = true;
                    break;
                  }else{ // 옆칸의 값이 대상 값과 다르다면
                    break; // 반복문 break;
                  }
                }else{ // 옆 칸에 값이 없다면
                  if(k >= 0){
                    Change(k,j,k+1,"U");
                    is_moved = true;
                  }
                }
              }
            }
          }
        }
        if(is_moved) MakeRandomN();
      }
      function MoveDown(){
        var is_moved = false; // 움직였는지 여부
        for(var j = 0; j < 4; j++){
          for(var i = 3; i >= 0; i--){
            if(Gm.Counts[i][j] != 0){
              for(var k = i +1; k < 4; k++){
                if(Gm.Counts[k][j] != 0){ // 옆칸에 값이 있다면
                  if(Gm.Counts[k][j] == Gm.Counts[k-1][j] && Gm.Check[k][j] == 0){ // 옆칸의 값이 대상 값과 같다면
                    Mul2(k,j);
                    is_moved = true;
                    break;
                  }else{ // 옆칸의 값이 대상 값과 다르다면
                    break; // 반복문 break;
                  }
                }else{ // 옆 칸에 값이 없다면
                  if(k < 4){
                    Change(k,j,k-1,"D");
                    is_moved = true;
                  }
                }
              }
            }
          }
        }
        if(is_moved) MakeRandomN();
      }
      function Start(){
        Gm.Score = 0;
        Gm.gameState = "Play"
        StartMakeRandomN();
        Update();
        Gm.Board.id = 'StartBoard'
        Gm.StartScene.style.display = 'none'
      }
      function Ready(){
        Gm.gameState = "Ready"
      }
      function End(){
        Gm.gameState = "End"
        Gm.Board.setAttribute('id','ReadyBoard')
        Gm.EndScene.style.display = 'block'
      }
      function Clear(){
        Gm.gameState = "Clear"
        Gm.Board.setAttribute('id','ReadyBoard')
        Gm.ClearScene.style.display = 'block'
        Gm.ClearText.innerHTML = "당신에 점수는 ...! " + Gm.Score + "점...! 대다내...!!!"
      }
      function DK(event){
        if(Gm.gameState == "Play"){
            switch(event.keyCode) {
          		case 37:
                MoveLeft();
                Update();
          			break;
          		case 38:
                MoveUp();
                Update();
          			break;
          		case 39:
                MoveRight();
                Update();
          			break;
          		case 40:
                MoveDown();
                Update();
            		break;
          	}
          }else{
            switch(event.keyCode) {
              case 65:
                Start();
                break;
            }
          }
        }

      window.onload = function(){
        Gm = new GameManager();
        Gm.Score = 0;
        document.addEventListener("keydown", DK, false);
        Gm.StartBtn.addEventListener('click',Start)
        Ready(Gm);
      }
     </script>
  </body>
</html>
