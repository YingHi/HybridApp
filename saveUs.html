<!-- https://v3-docs.vuejs-korea.org/  -->
<html lang="ko" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>정말 귀찮아!</title>
    <style media="screen">
    .block{
      text-align: center;
      font-size: 30px;
      color: white;
    }
    #game{
      height: 500px;
      width: 500px;
      background-color: black;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      grid-template-rows: 1fr 1fr 1fr 1fr;
      grid-gap: 10px;
      padding: 10px;
    }
    #no{
      background-color: pink;
    }
    #count2{
      background-color: #666666;
    }
    #count4{
      background-color: #666688;
    }
    #count8{
      background-color: #886688;
    }
    #count16{
      background-color: #888888;
    }
    #count32{
      background-color: #8888AA;
    }
    #count64{
      background-color: #AA88AA;
    }
    #count128{
      background-color: #AAAAAA;
    }
    #count256{
      background-color: #AAAABB;
    }
    #count512{
      background-color: #BBAABB;
    }
    #count1024{
      background-color: #BBAABB;
    }
    #count2048{
      background-color: #BBBBBB;
    }
    </style>
  </head>
  <body>
    <script src="https://unpkg.com/vue@3"></script>
    <div id="game">
      <div v-for="index in count" class = "block" id="no"></div>
    </div>
     <script>
     const { createApp } = Vue;
      createApp({
        data() {
          return {
            count : 16,
          }
        }
      }).mount('#game')
      var Counts = [[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]] // 숫자 배열
      var Check = [[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]] // 이동여부 배열
      var Blocks = document.getElementsByClassName("block")
      function Reset(){
        Check = [[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]
      }
      function Update(){
        for(var i = 0; i < 4; i++){
          for(var j = 0; j < 4; j++){
            var a = i * 4;
            var b = a + j;
            if(Counts[i][j] != 0){
              Blocks[b].innerHTML = Counts[i][j]; // 배열의 값을 블록에 넣음
              Blocks[b].id = "count" + Counts[i][j];
            }else{
              Blocks[b].innerHTML = ""; // 배열의 값을 블록에 넣음
              Blocks[b].id = "no";
            }
          }
        }
        Reset();
      }
      function MakeRandomN(){
        while(true){
          var X = parseInt(Math.random() * 4);
          var Y = parseInt(Math.random() * 4);
          if(Counts[X][Y] == 0){
            var Z = parseInt(Math.random() * 10);
            if(Z > 7){
              Counts[X][Y] = 4;
              break;
            }else{
              Counts[X][Y] = 2;
              break;
            }
          }
        }
      }
      function MoveLeft(){
        var is_moved = false; // 움직였는지 여부ㅓ
        for(var i = 0; i < 4; i++){
          for(var j = 0; j < 4; j++){
            if(Counts[i][j] != 0){ // 지금 선택된 칸이 0이 아니라면(값이 있다면)
              var val = Counts[i][j] // val에대가 현재 선택된 칸의 값을 저장
              for(var k = j -1; k >=0; k--){ // 왼쪽으로 이동, 만약에 같은 값이 있다면 합치기
                if(Counts[i][k] != 0){ // 옆칸에 값이 있다면
                  if(Counts[i][k] == Counts[i][k+1] && Check[i][k] == 0){ // 옆칸의 값이 대상 값과 같다면
                    Counts[i][k] *= 2;
                    Check[i][k] = 1;
                    Counts[i][k+1] = 0;
                    is_moved = true;
                    break;
                  }else{ // 옆칸의 값이 대상 값과 다르다면
                    break; // 반복문 break;
                  }
                }else{ // 옆 칸에 값이 없다면
                  if(k < 4){
                    Counts[i][k] = Counts[i][k+1];
                    Counts[i][k+1] = 0;
                    is_moved = true;
                  }
                }
              }
            }
          }
        }
        if(is_moved) MakeRandomN();
      }

      function MoveRight(){
        var is_moved = false; // 움직였는지 여부
        for(var i = 0; i < 4; i++){
          for(var j = 3; j >= 0; j--){
            if(Counts[i][j] != 0){
              var val = Counts[i][j]
              for(var k = j +1; k < 4; k++){
                if(Counts[i][k] != 0){ // 옆칸에 값이 있다면
                  if(Counts[i][k] == Counts[i][k-1] && Check[i][k] == 0){ // 옆칸의 값이 대상 값과 같다면
                    Counts[i][k] *= 2;
                    Check[i][k] = 1;
                    Counts[i][k-1] = 0;
                    is_moved = true;
                    break;
                  }else{ // 옆칸의 값이 대상 값과 다르다면
                    break; // 반복문 break;
                  }
                }else{ // 옆 칸에 값이 없다면
                  if(k >= 0){
                    Counts[i][k] = Counts[i][k-1];
                    Counts[i][k-1] = 0;
                    is_moved = true;
                  }
                }
              }
            }
          }
        }
        if(is_moved) MakeRandomN();
      }
      function MoveUp(){
        var is_moved = false; // 움직였는지 여부
        for(var j = 0; j < 4; j++){
          for(var i = 0; i < 4; i++){
            if(Counts[i][j] != 0){
              var val = Counts[i][j]
              for(var k = i -1; k >=0; k--){
                if(Counts[k][j] != 0){ // 옆칸에 값이 있다면
                  if(Counts[k][j] == Counts[k+1][j] && Check[k][j] == 0){ // 옆칸의 값이 대상 값과 같다면
                    Counts[k][j] *= 2;
                    Check[k][j] = 1;
                    Counts[k+1][j] = 0;
                    is_moved = true;
                    break;
                  }else{ // 옆칸의 값이 대상 값과 다르다면
                    break; // 반복문 break;
                  }
                }else{ // 옆 칸에 값이 없다면
                  if(k >= 0){
                    Counts[k][j] = Counts[k+1][j];
                    Counts[k+1][j] = 0;
                    is_moved = true;
                  }
                }
              }
            }
          }
        }
        if(is_moved) MakeRandomN();
      }
      function MoveDown(){
        var is_moved = false; // 움직였는지 여부
        for(var j = 0; j < 4; j++){
          for(var i = 3; i >= 0; i--){
            if(Counts[i][j] != 0){
              var val = Counts[i][j]
              for(var k = i +1; k < 4; k++){
                if(Counts[k][j] != 0){ // 옆칸에 값이 있다면
                  if(Counts[k][j] == Counts[k-1][j] && Check[k][j] == 0){ // 옆칸의 값이 대상 값과 같다면
                    Counts[k][j] *= 2;
                    Check[k][j] = 1;
                    Counts[k-1][j] = 0;
                    is_moved = true;
                    break;
                  }else{ // 옆칸의 값이 대상 값과 다르다면
                    break; // 반복문 break;
                  }
                }else{ // 옆 칸에 값이 없다면
                  if(k < 4){
                    Counts[k][j] = Counts[k-1][j];
                    Counts[k-1][j] = 0;
                    is_moved = true;
                  }
                }
              }
            }
          }
        }
        if(is_moved) MakeRandomN();
      }
      document.addEventListener("keydown", DK, false);
      function DK(event){
        switch(event.keyCode) {
      		case 37:
          MoveLeft();
          Update();
    			console.log("left Pressed")
    			break;
      		case 38:
          MoveUp();
          Update();
    			console.log("up Pressed")
    			break;
      		case 39:
          MoveRight();
          Update();
    			console.log("right Pressed")
    			break;
      		case 40:
          MoveDown();
          Update();
      			console.log("down Pressed")
      			break;
      	}
      }
      window.onload = function(){
        MakeRandomN();
        MakeRandomN();
        Update();
      }
     </script>
  </body>
</html>
